{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Rey%20Omar%20Esguerra/Downloads/reyecommerce/app/%28store%29/basket/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(store)/basket/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(store)/basket/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA+R,GAC5T,6DACA"}},
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Rey%20Omar%20Esguerra/Downloads/reyecommerce/app/%28store%29/basket/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(store)/basket/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(store)/basket/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA2Q,GACxS,yCACA"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 51, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Rey%20Omar%20Esguerra/Downloads/reyecommerce/lib/imageUrl.ts"],"sourcesContent":["import { client } from \"@/sanity/lib/client\";\r\nimport imageUrlBuilder from \"@sanity/image-url\";\r\nimport { SanityImageSource } from \"@sanity/image-url/lib/types/types\";\r\n\r\nconst builder = imageUrlBuilder(client);\r\n\r\nexport function imageUrl(source: SanityImageSource) {\r\n    return builder.image(source);\r\n}"],"names":[],"mappings":";;;AAAA;AACA;;;AAGA,MAAM,UAAU,CAAA,GAAA,gKAAA,CAAA,UAAe,AAAD,EAAE,uHAAA,CAAA,SAAM;AAE/B,SAAS,SAAS,MAAyB;IAC9C,OAAO,QAAQ,KAAK,CAAC;AACzB"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Rey%20Omar%20Esguerra/Downloads/reyecommerce/lib/stripe.ts"],"sourcesContent":["import Stripe from 'stripe';\r\n\r\nif (!process.env.STRIPE_SECRET_KEY) {\r\n  throw new Error('STRIPE_SECRET_KEY is not set');\r\n}\r\n\r\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {\r\n  apiVersion: '2025-04-30.basil', // Use the latest api version\r\n  typescript: true,\r\n});\r\n\r\nexport default stripe;"],"names":[],"mappings":";;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAE;IAClC,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,SAAS,IAAI,sJAAA,CAAA,UAAM,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAE;IACvD,YAAY;IACZ,YAAY;AACd;uCAEe"}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Rey%20Omar%20Esguerra/Downloads/reyecommerce/actions/createCheckoutSession.ts"],"sourcesContent":["'use server'\r\n\r\nimport { imageUrl } from \"@/lib/imageUrl\";\r\nimport stripe from \"@/lib/stripe\";\r\nimport { BasketItem } from \"@/store/store\";\r\n\r\nexport type Metadata = {\r\n    orderNumber: string;\r\n    customerName: string;\r\n    customerEmail: string;\r\n    clerkUserId: string;\r\n};\r\n\r\nexport type GroupedBasketItem = {\r\n    product:BasketItem['product'];\r\n    quantity: number;\r\n};\r\n\r\nexport async function createCheckoutSession(\r\n    items: GroupedBasketItem[],\r\n    metadata: Metadata\r\n){\r\n  try {\r\n    // check if any grouped items do not have a price\r\n    const itemsWhithoutPrice = items.filter((item) => !item.product.price);\r\n    if (itemsWhithoutPrice.length > 0) {\r\n      throw new Error('Some items do not have a price');\r\n    }\r\n\r\n    const customers = await stripe.customers.list({\r\n      email: metadata.customerEmail,\r\n      limit: 1,\r\n    });\r\n\r\n    let customerId: string | undefined;\r\n    if (customers.data.length > 0) {\r\n      customerId = customers.data[0].id;\r\n    }\r\n\r\n    const baseUrl = process.env.NODE_ENV === 'production'\r\n      ? `https://${process.env.VERCEL_URL}`\r\n      : `${process.env.NEXT_PUBLIC_BASE_URL}`;\r\n    const successUrl = `${baseUrl}/success?session_id={CHECKOUT_SESSION_ID}&orderNumber=${metadata.orderNumber}`;\r\n    const cancelUrl = `${baseUrl}/basket`;\r\n//3:57:00\r\n    const session = await stripe.checkout.sessions.create({\r\n      customer: customerId,\r\n      customer_creation: customerId ? undefined : 'always',\r\n      customer_email: !customerId ? metadata.customerEmail : undefined,\r\n      metadata,\r\n      mode: 'payment',\r\n      allow_promotion_codes: true,\r\n      success_url: successUrl,\r\n      cancel_url: cancelUrl,\r\n      line_items: items.map((item) => ({\r\n        price_data: {\r\n          currency: 'gbp', // Libra Esterlina\r\n          unit_amount: Math.round(item.product.price! * 100),\r\n          product_data: {\r\n            name: item.product.name || 'Unnamed Product',\r\n            description: ` Product ID: ${item.product._id}`,\r\n            metadata: {\r\n              id: item.product._id,\r\n            },\r\n            images: item.product.image\r\n              ? [imageUrl(item.product.image).url()]\r\n              : undefined,\r\n          }, //3:42:49\r\n        },\r\n        quantity: item.quantity,\r\n      })),\r\n    });\r\n\r\n    return session.url;\r\n  } catch (error) {\r\n    console.error('Error creating checkout session:', error);\r\n    throw error;\r\n  }  \r\n}\r\n\r\n//3:34:03"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;;AAeO,eAAe,uCAAmB,GAAnB,sBAClB,KAA0B,EAC1B,QAAkB;IAEpB,IAAI;QACF,iDAAiD;QACjD,MAAM,qBAAqB,MAAM,MAAM,CAAC,CAAC,OAAS,CAAC,KAAK,OAAO,CAAC,KAAK;QACrE,IAAI,mBAAmB,MAAM,GAAG,GAAG;YACjC,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,YAAY,MAAM,6GAAA,CAAA,UAAM,CAAC,SAAS,CAAC,IAAI,CAAC;YAC5C,OAAO,SAAS,aAAa;YAC7B,OAAO;QACT;QAEA,IAAI;QACJ,IAAI,UAAU,IAAI,CAAC,MAAM,GAAG,GAAG;YAC7B,aAAa,UAAU,IAAI,CAAC,EAAE,CAAC,EAAE;QACnC;QAEA,MAAM,UAAU,6EAEZ,4DAAqC;QACzC,MAAM,aAAa,GAAG,QAAQ,sDAAsD,EAAE,SAAS,WAAW,EAAE;QAC5G,MAAM,YAAY,GAAG,QAAQ,OAAO,CAAC;QACzC,SAAS;QACL,MAAM,UAAU,MAAM,6GAAA,CAAA,UAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACpD,UAAU;YACV,mBAAmB,aAAa,YAAY;YAC5C,gBAAgB,CAAC,aAAa,SAAS,aAAa,GAAG;YACvD;YACA,MAAM;YACN,uBAAuB;YACvB,aAAa;YACb,YAAY;YACZ,YAAY,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;oBAC/B,YAAY;wBACV,UAAU;wBACV,aAAa,KAAK,KAAK,CAAC,KAAK,OAAO,CAAC,KAAK,GAAI;wBAC9C,cAAc;4BACZ,MAAM,KAAK,OAAO,CAAC,IAAI,IAAI;4BAC3B,aAAa,CAAC,aAAa,EAAE,KAAK,OAAO,CAAC,GAAG,EAAE;4BAC/C,UAAU;gCACR,IAAI,KAAK,OAAO,CAAC,GAAG;4BACtB;4BACA,QAAQ,KAAK,OAAO,CAAC,KAAK,GACtB;gCAAC,CAAA,GAAA,+GAAA,CAAA,WAAQ,AAAD,EAAE,KAAK,OAAO,CAAC,KAAK,EAAE,GAAG;6BAAG,GACpC;wBACN;oBACF;oBACA,UAAU,KAAK,QAAQ;gBACzB,CAAC;QACH;QAEA,OAAO,QAAQ,GAAG;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,MAAM;IACR;AACF,EAEA,SAAS;;;IA9Da;;AAAA,+OAAA"}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}